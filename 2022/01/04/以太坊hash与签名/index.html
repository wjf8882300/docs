<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="以太坊hash与签名, docker linux java database blockchain">
    <meta name="description" content="1.交易签名
1.1 交易签名的构成
下面以授权为例：
0xf8ac8201368502540be400830c350094425c2d431065fcf120e78d47b88067349795fe3e80b844095ea7b30000">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>以太坊hash与签名 | 筑梦未来</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery-3.6.0.min.js"></script>

<meta name="generator" content="Hexo 5.4.1"></head>




<body>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">筑梦未来</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">筑梦未来</div>
        <div class="logo-desc">
            
            路漫漫其修远兮，吾将上下而求索。
            
        </div>
    </div>

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/wjf8882300/wjf8882300.github.io" class="waves-effect waves-light" target="_blank">
                <i class="fab fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>


        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/wjf8882300/wjf8882300.github.io" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    



<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/6.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">以太坊hash与签名</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/">
                                <span class="chip bg-color">以太坊</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fas fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" class="post-category">
                                区块链
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-01-04
                </div>
                

                

                

                

                
            </div>
        </div>
        <hr class="clearfix">

        
        <!-- 是否加载使用自带的 prismjs. -->
        <link rel="stylesheet" href="/libs/prism/prism.css">
        

        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="1-交易签名">1.交易签名</h2>
<h3 id="1-1-交易签名的构成">1.1 交易签名的构成</h3>
<p>下面以授权为例：<br>
0xf8ac8201368502540be400830c350094425c2d431065fcf120e78d47b88067349795fe3e80b844095ea7b300000000000<br>
0000000000000629aa1e54564fe9f917143bed33fc280a8fdd93f0000000000000000000000000000000000000000000000<br>
000000b5e620f480002ba0474d4e4e464e415abba86600fd7f0a75261cd89a3857c0e0d3e9676f028d534ea028b64c84c86<br>
dc60eba4186db8922946c2b30d42f7bcd698a86cd65740ce6580f</p>
<ul>
<li>0136 表示nonce</li>
<li>02540be400 表示gas price，转换为10进制为10000000000，即10Gwei</li>
<li>0c3500 表示gas limit，转为10进制即800000</li>
<li>425C2D431065fcf120E78d47b88067349795Fe3e 即to，表示合约地址0x425C2D431065fcf120E78d47b88067349795Fe3e</li>
<li>b844表示value，按理应该是0，不知道具体含义</li>
<li>095ea7b3 methodId</li>
<li>000000000000000000000000629aa1e54564fe9f917143bed33fc280a8fdd93f 授权的钱包或者合约地址0x629aa1e54564fe9f917143bed33fc280a8fdd93f</li>
<li>0000000000000000000000000000000000000000000000000000b5e620f48000 授权的金额即0.0002个ETH</li>
<li>2ba0474d4e4e464e415abba86600fd7f0a75261cd89a3857c0e0d3e9676f028d534ea028b64c84c86dc60eba4186db892294<br>
6c2b30d42f7bcd698a86cd65740ce6580f为签名数据<br>
<img src="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/eth-01.png" alt></li>
</ul>
<h3 id="1-2-js版本交易签名">1.2 js版本交易签名</h3>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;**
 * 授权
 * @author wangjf 
 * @version v1.0
 * @date 2021-12-7
 *&#x2F;
var Tx     &#x3D; require(&#39;ethereumjs-tx&#39;).Transaction
var ethUtil &#x3D; require(&#39;ethereumjs-util&#39;);
const Web3 &#x3D; require(&#39;web3&#39;)
const rpcURL &#x3D; &quot;http:&#x2F;&#x2F;xxx.xxx.xxx.xxx:18545&quot;

const web3 &#x3D; new Web3(rpcURL)

&#x2F;** 
 * 买家、卖家、平台地址、私钥 
 *&#x2F;
const buyer &#x3D; &quot;0xCD2bedb135ba3e16F54d2B51959506297e78739D&quot;
const buyer_privateKey &#x3D; Buffer.from(&#39;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#39;, &#39;hex&#39;)

&#x2F;** 
 * 交易金额： 0.0002 ether
 *&#x2F;
const value &#x3D; &#39;0.0002&#39;

&#x2F;**
 * 代币合约地址
 *&#x2F;
const usdtAddress &#x3D; &#39;0x425C2D431065fcf120E78d47b88067349795Fe3e&#39;
&#x2F;**
 * 业务合约地址
 *&#x2F;
const contractAddress &#x3D; &#39;0x629aa1e54564fe9f917143bed33fc280a8fdd93f&#39;

&#x2F;**
 * 代币合约的abi文件
 *&#x2F;
const contractABI &#x3D; [
	&#123;
		&quot;constant&quot;: false,
		&quot;inputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;spender&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;name&quot;: &quot;value&quot;,
				&quot;type&quot;: &quot;uint256&quot;
			&#125;
		],
		&quot;name&quot;: &quot;approve&quot;,
		&quot;outputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;&quot;,
				&quot;type&quot;: &quot;bool&quot;
			&#125;
		],
		&quot;payable&quot;: false,
		&quot;stateMutability&quot;: &quot;nonpayable&quot;,
		&quot;type&quot;: &quot;function&quot;
	&#125;,
	&#123;
		&quot;constant&quot;: false,
		&quot;inputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;from&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;name&quot;: &quot;to&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;name&quot;: &quot;value&quot;,
				&quot;type&quot;: &quot;uint256&quot;
			&#125;
		],
		&quot;name&quot;: &quot;transferFrom&quot;,
		&quot;outputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;&quot;,
				&quot;type&quot;: &quot;bool&quot;
			&#125;
		],
		&quot;payable&quot;: false,
		&quot;stateMutability&quot;: &quot;nonpayable&quot;,
		&quot;type&quot;: &quot;function&quot;
	&#125;,
	&#123;
		&quot;constant&quot;: true,
		&quot;inputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;who&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;
		],
		&quot;name&quot;: &quot;balanceOf&quot;,
		&quot;outputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;&quot;,
				&quot;type&quot;: &quot;uint256&quot;
			&#125;
		],
		&quot;payable&quot;: false,
		&quot;stateMutability&quot;: &quot;view&quot;,
		&quot;type&quot;: &quot;function&quot;
	&#125;,
	&#123;
		&quot;constant&quot;: false,
		&quot;inputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;to&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;name&quot;: &quot;value&quot;,
				&quot;type&quot;: &quot;uint256&quot;
			&#125;
		],
		&quot;name&quot;: &quot;transfer&quot;,
		&quot;outputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;&quot;,
				&quot;type&quot;: &quot;bool&quot;
			&#125;
		],
		&quot;payable&quot;: false,
		&quot;stateMutability&quot;: &quot;nonpayable&quot;,
		&quot;type&quot;: &quot;function&quot;
	&#125;,
	&#123;
		&quot;constant&quot;: true,
		&quot;inputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;owner&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;name&quot;: &quot;spender&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;
		],
		&quot;name&quot;: &quot;allowance&quot;,
		&quot;outputs&quot;: [
			&#123;
				&quot;name&quot;: &quot;&quot;,
				&quot;type&quot;: &quot;uint256&quot;
			&#125;
		],
		&quot;payable&quot;: false,
		&quot;stateMutability&quot;: &quot;view&quot;,
		&quot;type&quot;: &quot;function&quot;
	&#125;,
	&#123;
		&quot;anonymous&quot;: false,
		&quot;inputs&quot;: [
			&#123;
				&quot;indexed&quot;: true,
				&quot;name&quot;: &quot;from&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;indexed&quot;: true,
				&quot;name&quot;: &quot;to&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;indexed&quot;: false,
				&quot;name&quot;: &quot;value&quot;,
				&quot;type&quot;: &quot;uint256&quot;
			&#125;
		],
		&quot;name&quot;: &quot;Transfer&quot;,
		&quot;type&quot;: &quot;event&quot;
	&#125;,
	&#123;
		&quot;anonymous&quot;: false,
		&quot;inputs&quot;: [
			&#123;
				&quot;indexed&quot;: true,
				&quot;name&quot;: &quot;owner&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;indexed&quot;: true,
				&quot;name&quot;: &quot;spender&quot;,
				&quot;type&quot;: &quot;address&quot;
			&#125;,
			&#123;
				&quot;indexed&quot;: false,
				&quot;name&quot;: &quot;value&quot;,
				&quot;type&quot;: &quot;uint256&quot;
			&#125;
		],
		&quot;name&quot;: &quot;Approval&quot;,
		&quot;type&quot;: &quot;event&quot;
	&#125;
]

&#x2F;**
 * 创建合约对象
 *&#x2F;
const contract &#x3D; new web3.eth.Contract(contractABI, usdtAddress)

&#x2F;**
 * 生成调用合约的abi对象
 *&#x2F;
const data &#x3D; contract.methods.approve(contractAddress, web3.utils.toWei(value, &#39;ether&#39;)).encodeABI()

&#x2F;**
 * 获取nonce并调用合约
 * @note  注意付款由买家发起
 *&#x2F;
web3.eth.getTransactionCount(buyer, (err, txCount) &#x3D;&gt; &#123;

    &#x2F;&#x2F; 创建交易对象
    const txObject &#x3D; &#123;
        nonce:    web3.utils.toHex(txCount),
        gasLimit: web3.utils.toHex(800000),
        gasPrice: web3.utils.toHex(web3.utils.toWei(&#39;10&#39;, &#39;gwei&#39;)),
        to: usdtAddress,
		data: data,
		value : 0,
      &#125;
  
    &#x2F;&#x2F; 签署交易
	const tx &#x3D; new Tx(txObject, &#123; chain: &#39;rinkeby&#39;, hardfork: &#39;petersburg&#39; &#125;)
	&#x2F;&#x2F; 买家私钥签名
	tx.sign(buyer_privateKey)
	
	&#x2F;&#x2F; 查看即将序列化的数据
	console.log(tx.raw);
	const serializedTx &#x3D; tx.serialize()
	const raw &#x3D; &#39;0x&#39; + serializedTx.toString(&#39;hex&#39;)
	&#x2F;&#x2F; 查看16进制数据
	console.log(raw);

	
  
    &#x2F;&#x2F; 广播交易
    web3.eth.sendSignedTransaction(raw, (err, txHash) &#x3D;&gt; &#123;
      console.log(&#39;txHash:&#39;, txHash)
      &#x2F;&#x2F; 可以去ropsten.etherscan.io查看交易详情
    &#125;)
  &#125;)  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>js输出：</p>
<pre class="line-numbers language-none"><code class="language-none">$ node viv-contract-usdt-aprrove
[
  &lt;Buffer 01 36&gt;,
  &lt;Buffer 02 54 0b e4 00&gt;,
  &lt;Buffer 0c 35 00&gt;,
  &lt;Buffer 42 5c 2d 43 10 65 fc f1 20 e7 8d 47 b8 80 67 34 97 95 fe 3e&gt;,
  &lt;Buffer &gt;,
  &lt;Buffer 09 5e a7 b3 00 00 00 00 00 00 00 00 00 00 00 00 62 9a a1 e5 45 64 fe 9f 91 71 43 be d3 3f c2 80 a8 fd d9 3f 00 00 00 00 00 00 00 00 00 00 00 00 00 0
0 ... 18 more bytes&gt;,
  &lt;Buffer 2b&gt;,
  &lt;Buffer 47 4d 4e 4e 46 4e 41 5a bb a8 66 00 fd 7f 0a 75 26 1c d8 9a 38 57 c0 e0 d3 e9 67 6f 02 8d 53 4e&gt;,
  &lt;Buffer 28 b6 4c 84 c8 6d c6 0e ba 41 86 db 89 22 94 6c 2b 30 d4 2f 7b cd 69 8a 86 cd 65 74 0c e6 58 0f&gt;
]
0xf8ac8201368502540be400830c350094425c2d431065fcf120e78d47b88067349795fe3e80b844095ea7b3000000000000000000000000629aa1e54564fe9f917143bed33fc280a8fdd93f000000
0000000000000000000000000000000000000000000000b5e620f480002ba0474d4e4e464e415abba86600fd7f0a75261cd89a3857c0e0d3e9676f028d534ea028b64c84c86dc60eba4186db892294
6c2b30d42f7bcd698a86cd65740ce6580f
txHash: 0x578e7508be076fbf9c7c29b1440b2719b8f593e2ef8be8cf278d3a90c5d0c03c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>从输出可以看出签名数据的整个结构</p>
<h3 id="1-3-java版本交易签名">1.3 java版本交易签名</h3>
<pre class="line-numbers language-none"><code class="language-none">public String transferContractTransaction(String fromAddress, String fromPrivateKey, String contractAddress, String contractFunction, BigInteger gasPrice, BigInteger gasLimit, BigInteger value, List&lt;Type&gt; inputParameters, List&lt;TypeReference&lt;?&gt;&gt; outputParameters) throws Exception &#123;
        Function function &#x3D; new Function(
                contractFunction,
                inputParameters,
                outputParameters);
        String encodedFunction &#x3D; FunctionEncoder.encode(function);
        Credentials credentials &#x3D; Credentials.create(fromPrivateKey);
 
        BigInteger nonce &#x3D; getNonce(credentials.getAddress());
        RawTransaction rawTransaction &#x3D; RawTransaction.createTransaction(nonce, gasPrice, gasLimit, contractAddress, value, encodedFunction);
 
        &#x2F;&#x2F;签名
        byte[] signedMessage &#x3D; TransactionEncoder.signMessage(rawTransaction, vivConfig.getEth().getChainId(), credentials);
        String hexValue &#x3D; Numeric.toHexString(signedMessage);
        log.info(&quot;transferContract hexValue: &#123;&#125;&quot;, hexValue);
 
        &#x2F;&#x2F;发起交易
        EthSendTransaction ethSendTransaction &#x3D;
                Web3jUtil.getInstance().ethSendRawTransaction(hexValue).send();
        if (ethSendTransaction.hasError()) &#123;
            throw new CustomException(500, ethSendTransaction.getError().getMessage());
        &#125;
        String transactionHash &#x3D; ethSendTransaction.getTransactionHash();
        return transactionHash;
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="1-4-java解析签名">1.4 java解析签名</h3>
<pre class="line-numbers language-none"><code class="language-none">public EthApproveVO getUsdtApprove(String hexValue) throws Exception &#123;
        SignedRawTransaction rawTransaction &#x3D; (SignedRawTransaction)TransactionDecoder.decode(hexValue);
        String data &#x3D; rawTransaction.getData();
        String methodHex &#x3D; &quot;0x&quot; + data.substring(0, 8);
        if(!CommonConst.Contract.ERC20.METHOD_APPROVAL.getCode().equals(methodHex)) &#123;
            log.error(&quot;16进制数据有误，非授权！&#123;&#125;&quot;, hexValue);
            return null;
        &#125;

        &#x2F;&#x2F; function approve(address spender, uint256 value) external returns (bool);
        List&lt;Type&gt; result &#x3D; FunctionReturnDecoder.decode(data.substring(8), Utils.convert(Arrays.&lt;TypeReference&lt;?&gt;&gt;asList(
                new TypeReference&lt;Address&gt;() &#123;&#125;,
                new TypeReference&lt;Uint&gt;() &#123;&#125;
        )));
        EthApproveVO ethApproveVO &#x3D; new EthApproveVO();
        ethApproveVO.setNonce(rawTransaction.getNonce());
        ethApproveVO.setGasPrice(Convert.fromWei(new BigDecimal(rawTransaction.getGasPrice()), Convert.Unit.ETHER));
        ethApproveVO.setGasLimit(new BigDecimal(rawTransaction.getGasLimit()));
        ethApproveVO.setSpender(((Address)result.get(0)).getValue());
        ethApproveVO.setValue(Convert.fromWei(new BigDecimal(((Uint) result.get(1)).getValue()), Convert.Unit.ETHER));
        ethApproveVO.setFrom(rawTransaction.getFrom());
        return ethApproveVO;
    &#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="2-普通签名">2.普通签名</h2>
<h3 id="2-1-需求">2.1 需求</h3>
<p>我们经常需要在solidity中通过恢复签名的钱包地址来判断用户身份，需要在remix自带计算的签名、java中计算的签名、javascript中计算的签名均保持一致，并在solidity中可以恢复出地址。</p>
<h3 id="2-2-测试数据">2.2 测试数据</h3>
<p>remix计算hash和签名需要先转为ascii码。457542584823209984====&gt;0x343537353432353834383233323039393834</p>
<p>测试账户如图<br>
<img src="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/eth-02.png" alt><br>
原始串：457542584823209984</p>
<p>原始串ASCII码：0x343537353432353834383233323039393834</p>
<p>钱包地址：0x865Af88273B9218b94c46d12f34be460865B0A0d</p>
<h3 id="2-3-remix签名">2.3 remix签名</h3>
<h4 id="2-3-1-按如下图切换账户">2.3.1 按如下图切换账户</h4>
<p>用于签名的数据：457542584823209984<br>
<img src="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/eth-03.png" alt></p>
<h4 id="2-3-2-需要MetaMask授权">2.3.2 需要MetaMask授权</h4>
<p><img src="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/eth-04.png" alt></p>
<h4 id="2-3-3-得到签名结果">2.3.3 得到签名结果</h4>
<p>下面是加密结果：<br>
hash：<br>
0x8a590edede2c24dad749a698c8f018863fda7ae9d26b9d32716d45b46ee632c5<br>
signature：<br>
0x2d27aaeebc445d4fa1fba84e1261fa2431406fb49554ff88e76e892b5b59031a6adf3d151dd088e1bae2e488b40305965995ec2a9ea5c9b84f792beb6bedb1161b<br>
<img src="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/eth-05.png" alt></p>
<h3 id="2-4-solidity中还原出钱包地址">2.4 solidity中还原出钱包地址</h3>
<p>在solidity中通过签名和原始串还原出钱包地址</p>
<pre class="line-numbers language-none"><code class="language-none">&#x2F;&#x2F; SPDX-License-Identifier: GPL-3.0  solidity
pragma solidity ^0.8.4;
contract Test &#123;
 
    &#x2F;**
    * get hash
    * @param message The message will be used to hash.
    *&#x2F;
   function getHash(bytes memory message) internal pure returns (bytes32) &#123;
        return
            keccak256(
                abi.encodePacked(&quot;\x19Ethereum Signed Message:\n18&quot;, message)
            );
    &#125;
 
    &#x2F;**
     * Extract the public key
     * @param hash hash for sign
     * @param sig signed
     *&#x2F;
    function ecrecovery(bytes32 hash, bytes memory sig) internal pure returns (address) &#123;
        bytes32 h;
        bytes32 r;
        bytes32 s;
        uint8 v;
     
        if (sig.length !&#x3D; 65) &#123;
          return address(0);
        &#125;
     
        assembly &#123;
          h :&#x3D; hash
          r :&#x3D; mload(add(sig, 32))
          s :&#x3D; mload(add(sig, 64))
          v :&#x3D; and(mload(add(sig, 65)), 255)
        &#125;
     
        if (v &lt; 27) &#123;
          v +&#x3D; 27;
        &#125;
     
        if (v !&#x3D; 27 &amp;&amp; v !&#x3D; 28) &#123;
          return address(0);
        &#125;
     
        return ecrecover(h, v, r, s);
  &#125;
 
    function test(bytes memory tid, bytes memory sign) external pure returns (address)&#123;
        bytes32 hashValue &#x3D; getHash(tid);
        return ecrecovery(hashValue, sign);
    &#125;
     
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输入如下数据：</p>
<p>注意传给solidity必须是ASCII码格式的0x343537353432353834383233323039393834</p>
<p>tid：0x343537353432353834383233323039393834<br>
sign：0x2d27aaeebc445d4fa1fba84e1261fa2431406fb49554ff88e76e892b5b59031a6adf3d151dd088e1bae2e488b40305965995ec2a9ea5c9b84f792beb6bedb1161b</p>
<p><img src="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/eth-06.png" alt></p>
<p>获取到钱包地址：0x865Af88273B9218b94c46d12f34be460865B0A0d</p>
<h3 id="2-5-javascript中的签名">2.5 javascript中的签名</h3>
<p>sign-3.js</p>
<pre class="line-numbers language-none"><code class="language-none">let ethUtil &#x3D; require(&quot;ethereumjs-util&quot;);
let msg &#x3D; &quot;457542584823209984&quot;; &#x2F;&#x2F;457542584823209984
 
&#x2F;**
 * 计算hash
 * @param &#123;*&#125; msg 源字符串
 *&#x2F;
function getHash(msg) &#123;
  const data &#x3D; ethUtil.toBuffer(Buffer.from(msg, &quot;utf8&quot;));
  const buf &#x3D; Buffer.concat([
    Buffer.from(
      &quot;\u0019Ethereum Signed Message:\n&quot; + data.length.toString(),
      &quot;utf8&quot;
    ),
    data
  ]);
  const hash &#x3D; ethUtil.keccak256(buf);
  return ethUtil.bufferToHex(hash);
&#125;
 
const tid &#x3D; ethUtil.toBuffer(Buffer.from(msg, &quot;utf8&quot;));
console.log(&quot;原始串：0x&quot; + msg);
console.log(&quot;ASCII码：&quot; + ethUtil.bufferToHex(tid));
 
var msgHash &#x3D; ethUtil.toBuffer(getHash(msg));
 
&#x2F;** 平台 *&#x2F;
let prikey &#x3D; ethUtil.toBuffer(&quot;0xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&quot;);
const rsv2 &#x3D; ethUtil.ecsign(msgHash, prikey);
console.log(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;平台&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&quot;);
console.log(&quot;hash: 0x&quot; + msgHash.toString(&#39;hex&#39;));
console.log(&quot;r: 0x&quot; + rsv2.r.toString(&#39;hex&#39;));
console.log(&quot;s: 0x&quot; + rsv2.s.toString(&#39;hex&#39;));
console.log(&quot;v: &quot; + rsv2.v.toString(16));
console.log(&quot;sign: 0x&quot; + rsv2.r.toString(&#39;hex&#39;) + rsv2.s.toString(&#39;hex&#39;) + rsv2.v.toString(16));<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出：</p>
<pre class="line-numbers language-none"><code class="language-none">DELL@WJF MINGW64 &#x2F;d&#x2F;workspace-viv&#x2F;viv-solidity&#x2F;viv&#x2F;test
$ node sign-3
原始串：0x457542584823209984
ASCII码：0x343537353432353834383233323039393834
&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;平台&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;
hash: 0x8a590edede2c24dad749a698c8f018863fda7ae9d26b9d32716d45b46ee632c5
r: 0x2d27aaeebc445d4fa1fba84e1261fa2431406fb49554ff88e76e892b5b59031a
s: 0x6adf3d151dd088e1bae2e488b40305965995ec2a9ea5c9b84f792beb6bedb116
v: 1b
sign: 0x2d27aaeebc445d4fa1fba84e1261fa2431406fb49554ff88e76e892b5b59031a6adf3d151dd088e1bae2e488b40305965995ec2a9ea5c9b84f792beb6bedb1161b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可见hash与sign均与remix计算出来的相同</p>
<h3 id="2-6-java代码中的签名">2.6 java代码中的签名</h3>
<p>引入web3j</p>
<pre class="line-numbers language-none"><code class="language-none">&lt;dependency&gt;
    &lt;groupId&gt;org.web3j&lt;&#x2F;groupId&gt;
    &lt;artifactId&gt;core&lt;&#x2F;artifactId&gt;
    &lt;version&gt;5.0.0&lt;&#x2F;version&gt;
&lt;&#x2F;dependency&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>hash与签名</p>
<pre class="line-numbers language-none"><code class="language-none">package com.uecent.viv.provider.blockchain.module.common.util;
 
import org.bouncycastle.asn1.x9.X9IntegerConverter;
import org.bouncycastle.crypto.params.ECDomainParameters;
import org.bouncycastle.math.ec.ECAlgorithms;
import org.bouncycastle.math.ec.ECPoint;
import org.bouncycastle.math.ec.custom.sec.SecP256K1Curve;
import org.web3j.crypto.Credentials;
import org.web3j.crypto.ECDSASignature;
import org.web3j.crypto.ECKeyPair;
import org.web3j.crypto.Hash;
import org.web3j.utils.Assertions;
import org.web3j.utils.Numeric;
 
import java.math.BigInteger;
import java.nio.charset.StandardCharsets;
import java.util.Arrays;
 
import static org.web3j.crypto.Sign.CURVE_PARAMS;
 
&#x2F;**
 * Web3j工具类
 *
 * @author ：wangjf
 * @date ：2021&#x2F;7&#x2F;23 17:06
 * @description：provider-viv-blockchain
 * @version: v1.1.0
 *&#x2F;
public class Test &#123;
 
    static final ECDomainParameters CURVE;
    static &#123;
        CURVE &#x3D; new ECDomainParameters(CURVE_PARAMS.getCurve(), CURVE_PARAMS.getG(), CURVE_PARAMS.getN(), CURVE_PARAMS.getH());
    &#125;
 
    public static void main(String[] args) &#123;
        String text &#x3D; &quot;457542584823209984&quot;;
        String privateKey &#x3D; &quot;0xf95816c196aec67bdae2f72005d4b11203162c72ed4e3833958e052df8a32edc&quot;;
        System.out.println(&quot;hash: &quot; + getHashHexString(text));
        System.out.println(&quot;sign: &quot; + signMessage(text, privateKey));
    &#125;
 
    &#x2F;**
     * 签名
     *
     * @param message    消息
     * @param privateKey 私钥
     * @return
     *&#x2F;
    public static String signMessage(String message, String privateKey) &#123;
        Credentials credentials &#x3D; Credentials.create(privateKey);
        ECKeyPair ecKeyPair &#x3D; credentials.getEcKeyPair();
        BigInteger publicKey &#x3D; ecKeyPair.getPublicKey();
        byte[] messageHash &#x3D; getHash(message);
        ECDSASignature sig &#x3D; ecKeyPair.sign(messageHash);
        int recId &#x3D; -1;
 
        int headerByte;
        for (headerByte &#x3D; 0; headerByte &lt; 4; ++headerByte) &#123;
            BigInteger k &#x3D; recoverFromSignature(headerByte, sig, messageHash);
            if (k !&#x3D; null &amp;&amp; k.equals(publicKey)) &#123;
                recId &#x3D; headerByte;
                break;
            &#125;
        &#125;
 
        if (recId &#x3D;&#x3D; -1) &#123;
            throw new RuntimeException(&quot;Could not construct a recoverable key. Are your credentials valid?&quot;);
        &#125; else &#123;
            headerByte &#x3D; recId + 27;
            byte[] v &#x3D; new byte[]&#123;(byte) headerByte&#125;;
            byte[] r &#x3D; Numeric.toBytesPadded(sig.r, 32);
            byte[] s &#x3D; Numeric.toBytesPadded(sig.s, 32);
 
            StringBuilder sign &#x3D; new StringBuilder();
            sign.append(Numeric.toHexString(r)).append(Numeric.toHexString(s).substring(2)).append(Numeric.toHexString(v).substring(2));
            return sign.toString();
        &#125;
    &#125;
 
    public static BigInteger recoverFromSignature(int recId, ECDSASignature sig, byte[] message) &#123;
        Assertions.verifyPrecondition(recId &gt;&#x3D; 0, &quot;recId must be positive&quot;);
        Assertions.verifyPrecondition(sig.r.signum() &gt;&#x3D; 0, &quot;r must be positive&quot;);
        Assertions.verifyPrecondition(sig.s.signum() &gt;&#x3D; 0, &quot;s must be positive&quot;);
        Assertions.verifyPrecondition(message !&#x3D; null, &quot;message cannot be null&quot;);
        BigInteger n &#x3D; CURVE.getN();
        BigInteger i &#x3D; BigInteger.valueOf((long) recId &#x2F; 2L);
        BigInteger x &#x3D; sig.r.add(i.multiply(n));
        BigInteger prime &#x3D; SecP256K1Curve.q;
        if (x.compareTo(prime) &gt;&#x3D; 0) &#123;
            return null;
        &#125; else &#123;
            ECPoint R &#x3D; decompressKey(x, (recId &amp; 1) &#x3D;&#x3D; 1);
            if (!R.multiply(n).isInfinity()) &#123;
                return null;
            &#125; else &#123;
                BigInteger e &#x3D; new BigInteger(1, message);
                BigInteger eInv &#x3D; BigInteger.ZERO.subtract(e).mod(n);
                BigInteger rInv &#x3D; sig.r.modInverse(n);
                BigInteger srInv &#x3D; rInv.multiply(sig.s).mod(n);
                BigInteger eInvrInv &#x3D; rInv.multiply(eInv).mod(n);
                ECPoint q &#x3D; ECAlgorithms.sumOfTwoMultiplies(CURVE.getG(), eInvrInv, R, srInv);
                byte[] qBytes &#x3D; q.getEncoded(false);
                return new BigInteger(1, Arrays.copyOfRange(qBytes, 1, qBytes.length));
            &#125;
        &#125;
    &#125;
 
    &#x2F;**
     * 计算hash，该hash与solidity的keccak256(abi.encodePacked(message))一致
     *
     * @param message
     * @return
     *&#x2F;
    public static byte[] getHash(String message) &#123;
        message &#x3D; Numeric.cleanHexPrefix(message);
        String str &#x3D; &quot;\u0019Ethereum Signed Message:\n18&quot; + message;
        byte[] bytes &#x3D; str.getBytes(StandardCharsets.UTF_8);
        return Hash.sha3(bytes);
    &#125;
 
    &#x2F;**
     * 计算hash，该hash与solidity的keccak256(abi.encodePacked(message))一致
     *
     * @param message
     * @return
     *&#x2F;
    public static String getHashHexString(String message) &#123;
        return Numeric.toHexString(getHash(message));
    &#125;
 
    private static ECPoint decompressKey(BigInteger xBN, boolean yBit) &#123;
        X9IntegerConverter x9 &#x3D; new X9IntegerConverter();
        byte[] compEnc &#x3D; x9.integerToBytes(xBN, 1 + x9.getByteLength(CURVE.getCurve()));
        compEnc[0] &#x3D; (byte) (yBit ? 3 : 2);
        return CURVE.getCurve().decodePoint(compEnc);
    &#125;
 
&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>输出：</p>
<pre class="line-numbers language-none"><code class="language-none">&quot;C:\Program Files\Java\jdk1.8.0_221\bin\java.exe&quot; &quot;-javaagent:D:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.1.3\lib\idea_rt.jar&#x3D;6631:D:\Program Files\JetBrains\IntelliJ IDEA Community Edition 2021.1.3\bin&quot; -Dfile.encoding&#x3D;UTF-8 -classpath C:\Users\DELL\AppData\Local\Temp\classpath1808972391.jar com.uecent.viv.provider.blockchain.module.common.util.Test
hash: 0x8a590edede2c24dad749a698c8f018863fda7ae9d26b9d32716d45b46ee632c5
sign: 0x2d27aaeebc445d4fa1fba84e1261fa2431406fb49554ff88e76e892b5b59031a6adf3d151dd088e1bae2e488b40305965995ec2a9ea5c9b84f792beb6bedb1161b

Process finished with exit code 0<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可见计算结果跟上面两种都一致。<br>
<img src="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/eth-07.png" alt></p>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">wjf8882300</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://wjf8882300.github.io/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/">https://wjf8882300.github.io/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8Ahash%E4%B8%8E%E7%AD%BE%E5%90%8D/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">wjf8882300</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/">
                                    <span class="chip bg-color">以太坊</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/01/04/%E6%95%B0%E5%AD%A6%E9%97%AE%E9%A2%98%EF%BC%8C%E6%89%BE%E5%87%BA%E7%AC%A6%E5%90%88%E6%9D%A1%E4%BB%B6%E7%9A%84%E9%A2%84%E7%AE%97%E7%AC%A6/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/22.jpg" class="responsive-img" alt="数学问题，找出符合条件的预算符">
                        
                        <span class="card-title">数学问题，找出符合条件的预算符</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-01-04
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E7%AE%97%E6%B3%95/" class="post-category">
                                    算法
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E7%AE%97%E6%B3%95/">
                        <span class="chip bg-color">算法</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/01/04/%E4%BB%A5%E5%A4%AA%E5%9D%8A%E5%90%88%E7%BA%A6%E7%BC%96%E5%86%99%E4%B8%8E%E9%83%A8%E7%BD%B2/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/10.jpg" class="responsive-img" alt="以太坊合约编写与部署">
                        
                        <span class="card-title">以太坊合约编写与部署</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-01-04
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/%E5%8C%BA%E5%9D%97%E9%93%BE/" class="post-category">
                                    区块链
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/%E4%BB%A5%E5%A4%AA%E5%9D%8A/">
                        <span class="chip bg-color">以太坊</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>



<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='false'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="/libs/aplayer/Meting.min.js"></script>

    

    <div class="container row center-align"
         style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2019-2022</span>
            
            <a href="/about" target="_blank">wjf8882300</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            
            
                
            
            
                <span id="busuanzi_container_site_pv">
                &nbsp;|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;
                    <span id="busuanzi_value_site_pv" class="white-color"></span>
            </span>
            
            
                <span id="busuanzi_container_site_uv">
                &nbsp;|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;
                    <span id="busuanzi_value_site_uv" class="white-color"></span>
            </span>
            
            <br>

            <!-- 运行天数提醒. -->
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/wjf8882300" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:wangjingfeng2008@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>













</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    

    

    <!-- 雪花特效 -->
    

    <!-- 鼠标星星特效 -->
    

     
        <script src="https://ssl.captcha.qq.com/TCaptcha.js"></script>
        <script src="/libs/others/TencentCaptcha.js"></script>
        <button id="TencentCaptcha" data-appid="xxxxxxxxxx" data-cbfn="callback" type="button" hidden></button>
    

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    

    

    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
